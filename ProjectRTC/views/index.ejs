<!DOCTYPE html>
<html ng-app="projectRtc">
  <head>
    <title><%= title %></title>
    <base href="/" />
    <link rel='stylesheet' href='/stylesheets/style.css' />
	
	<script type="text/javascript" src="/socket.io/socket.io.js"></script>
	<script type="text/javascript" src="javascripts/adapter.js"></script>
	<script type="text/javascript" src="javascripts/rtcClient.js"></script>
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
	<script type="text/javascript" src="javascripts/app.js"></script>
	<script>
		$(document).ready(function(){
			document.addEventListener('keydown', handleKey);
		}); 
		
		function handleKey(e) {
		  switch(e.code) {
			case "ArrowUp":
				console.log('forward');
				robotCommand('w');
			break;
			case "ArrowDown":
				console.log('backward');
				robotCommand('s');
			break;
			case "ArrowLeft":
				console.log('turn left');
				robotCommand('a');
			break;
			case "ArrowRight":
				console.log('turn right');
				robotCommand('d');
			break;
			case "Space":
				console.log('stop');
				robotCommand('x');
			break;
			case "Digit1":
				console.log('speed 1');
				robotCommand('1');
			break;
			case "Digit2":
				console.log('speed 2');
				robotCommand('2');
			break;
			case "Digit3":
				console.log('speed 3');
				robotCommand('3');
			break;
			case "Digit4":
				console.log('speed 4');
				robotCommand('4');
			break;
			case "Digit5":
				console.log('speed 5');
				robotCommand('5');
			break;
			case "NumpadAdd":
				$("#showCall").trigger("click");
			break;
			case "NumpadSubtract":
				$("#hideCall").trigger("click");
			break;
		  }
	   }
	   
	   function robotCommand(c) {
			var createPollRequest = new XMLHttpRequest();
			createPollRequest.open('GET', 'http://192.168.0.103:8080/' + c, true);
			createPollRequest.send();
			createPollRequest.onload = function () {
				if (createPollRequest.status >= 200 && createPollRequest.status < 400) {
					console.log('command ' + c + ' sent to robot');
				} else {
					console.log('cannot send command to robot')
				}
			};
	  }
	   
	</script>
  </head>
  <body>
  	<h1><%= header %></h1>

  	<%= include local-cam %>

  	<%= include remote-streams %>

  	<p class="footer"><%= footer %></p>
  </body>
</html>